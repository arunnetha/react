name: Multi-branch Pipeline

on:
  push:
    branches:
      - development
  pull_request:
    branches:
      - qa
      - non-prod
    types:
      - "closed"
env:
  SCR: ssssss
  VAR: scscs
jobs:
  build-and-test:
    runs-on: ubuntu-latest
    environment: development
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      # - name: Output Run ID
      #   run: echo ${{ github.run_id }}
      # - name: Output Run Number
      #   run: echo ${{ github.run_number }}
      # - name: Output Run Attempt
      #   run: echo ${{ github.run_attempt }}

      - name: Extract branch name
        shell: bash
        run: echo "branch=$(echo ${GITHUB_REF#refs/heads/})" >>$GITHUB_OUTPUT
        id: extract_branch
      - name: setup env name
        run: echo ${{ steps.extract_branch.outputs.branch }}
      - name: variables check
        run: | 
          echo $SCR
          echo ${{env.VAR}}

      - name: Deploy to environment
        run: |
          if [ "$MYSECRET" == "development" ]
          then
            echo "Got secret"
          else
            echo "no secret"
          fi
      
          if [ "$ENVIRONMENT" == "development" ]
          then
            echo "environment matched"
          else
            echo "environment not matched"
          fi
          
          if [ "$env_vars" == "development" ]
          then
            echo "variables matched"
          else
            echo "variables not matched"
          fi
          echo ${{ vars.development.ETEST }}
        env:
          ENVIRONMENT: ${{ steps.extract_branch.outputs.branch }}
          MYSECRET: ${{ secrets.MYSECRET}}
          # TESTSECURE: ${{ secrets.TEST }}
          env_vars: ${{ vars.ETEST }}